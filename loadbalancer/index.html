
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Kevin Campos">
      
      
      
        <link rel="prev" href="../webserver/">
      
      
        <link rel="next" href="../nagios/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Load Balancer - Project Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6f8fc17f.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#load-balancer-haproxy" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Project Documentation" class="md-header__button md-logo" aria-label="Project Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Project Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Load Balancer
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Project Documentation" class="md-nav__button md-logo" aria-label="Project Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Project Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Project Overview
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Services
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../webserver/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Web Servers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Load Balancer
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Load Balancer
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#choosing-haproxy" class="md-nav__link">
    <span class="md-ellipsis">
      Choosing HAProxy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Choosing HAProxy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-haproxy" class="md-nav__link">
    <span class="md-ellipsis">
      Why HAProxy?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-up-haproxy" class="md-nav__link">
    <span class="md-ellipsis">
      Setting Up HAProxy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    <span class="md-ellipsis">
      Getting Started
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#haproxy-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      HAProxy Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HAProxy Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#recommendations-for-production" class="md-nav__link">
    <span class="md-ellipsis">
      Recommendations for Production
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#challenges-faced" class="md-nav__link">
    <span class="md-ellipsis">
      Challenges Faced
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Challenges Faced">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-i-solved-them" class="md-nav__link">
    <span class="md-ellipsis">
      How I Solved Them
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lessons-learned" class="md-nav__link">
    <span class="md-ellipsis">
      Lessons Learned
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#articles-and-resources" class="md-nav__link">
    <span class="md-ellipsis">
      Articles and Resources
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nagios/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nagios
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../lessons_learned/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lessons Learned
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#choosing-haproxy" class="md-nav__link">
    <span class="md-ellipsis">
      Choosing HAProxy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Choosing HAProxy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-haproxy" class="md-nav__link">
    <span class="md-ellipsis">
      Why HAProxy?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-up-haproxy" class="md-nav__link">
    <span class="md-ellipsis">
      Setting Up HAProxy
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    <span class="md-ellipsis">
      Getting Started
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#haproxy-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      HAProxy Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HAProxy Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#recommendations-for-production" class="md-nav__link">
    <span class="md-ellipsis">
      Recommendations for Production
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#challenges-faced" class="md-nav__link">
    <span class="md-ellipsis">
      Challenges Faced
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Challenges Faced">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-i-solved-them" class="md-nav__link">
    <span class="md-ellipsis">
      How I Solved Them
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lessons-learned" class="md-nav__link">
    <span class="md-ellipsis">
      Lessons Learned
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#articles-and-resources" class="md-nav__link">
    <span class="md-ellipsis">
      Articles and Resources
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="load-balancer-haproxy">Load Balancer: HAProxy</h1>
<p>This section covers the implementation of HAProxy as the load balancer for this project, including insights into its setup, configuration, challenges faced, and lessons learned. Below, you'll find detailed explanations, relevant configurations, and external resources that guided the implementation.</p>
<hr />
<h2 id="overview">Overview</h2>
<details class="info">
<summary>What You'll Learn</summary>
<p>By the end of this section, you will understand:</p>
<ul>
<li>Why HAProxy was chosen as the load balancer.</li>
<li>The process of setting up and configuring HAProxy.</li>
<li>Key challenges faced during the implementation.</li>
<li>Lessons learned and resources that guided the implementation.</li>
</ul>
</details>
<p>HAProxy plays a critical role in this project by acting as a reverse proxy to distribute incoming traffic efficiently across multiple web servers. This setup enhances scalability and reliability, ensuring optimal performance under varying loads.</p>
<hr />
<h2 id="choosing-haproxy">Choosing HAProxy</h2>
<h3 id="why-haproxy">Why HAProxy?</h3>
<details class="tip">
<summary>Key Benefits of HAProxy</summary>
<ul>
<li>Performance: Highly efficient and capable of handling high traffic volumes.</li>
<li>Flexibility: Supports various load-balancing algorithms and configurations.</li>
<li>Stability: Proven reliability in production environments for years.</li>
<li>Open Source: Community-driven with strong documentation and support.</li>
</ul>
</details>
<p>While evaluating frameworks, I considered:</p>
<ul>
<li><strong>HAProxy</strong>: Known for performance and configurability in handling web traffic.lity.</li>
<li><strong>Nginx</strong>: A versatile choice, but I preferred a dedicated load balancer for this project.</li>
<li><strong>Traefik</strong>: Ideal for containerized environments but lacked some features I required.</li>
</ul>
<pre class="mermaid"><code>graph TD
    A[Load Balancer Evaluation] --&gt;|Performance| B(HAProxy)
    A --&gt;|Flexibility| C(Nginx)
    A --&gt;|Container Integration| D(Traefik)
    B --&gt; E[Final Choice]</code></pre>
<p>After comparing these options, HAProxy emerged as the best fit for this project due to its robust features, community support, and long-standing reputation for reliability in production environments.</p>
<h3 id="setting-up-haproxy">Setting Up HAProxy</h3>
<details class="success">
<summary>Process Summary</summary>
<ol>
<li>Installing HAProxy via Docker.</li>
<li>Configuring <code>haproxy.cfg</code> to define backend servers and load-balancing rules.</li>
<li>Testing the configuration locally and ensuring proper traffic distribution.</li>
<li>Integrating HAProxy with Flask-based web servers.</li>
</ol>
<h2 id="getting-started">Getting Started</h2>
<p>For a detailed step-by-step guide, refer to the <a href="../getting_started/">Getting Started</a> page.</p>
</details>
<h2 id="haproxy-configuration">HAProxy Configuration</h2>
<p>Below is a detailed explanation of the <code>haproxy.cfg</code> file used in this project. Each section is broken down with a comparison between the current setup and considerations for a production environment.</p>
<hr />
<div class="tabbed-set tabbed-alternate" data-tabs="1:5"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><input id="__tabbed_1_3" name="__tabbed_1" type="radio" /><input id="__tabbed_1_4" name="__tabbed_1" type="radio" /><input id="__tabbed_1_5" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">HAProxy Configuration (<code>haproxy.cfg</code>)</label><label for="__tabbed_1_2">global</label><label for="__tabbed_1_3">defaults</label><label for="__tabbed_1_4">frontend</label><label for="__tabbed_1_5">backend</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-text highlight"><span class="filename">haproxy.cfg</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>global
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    log stdout format raw local0
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    maxconn 4096
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>defaults
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    mode http
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    log     global
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    option  httplog
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    option  dontlognull
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    timeout connect 5s
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    timeout client  10s
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    timeout server  10s
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>frontend http_front
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>    bind *:60000-60001
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    default_backend backend_servers
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>    option forwardfor
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>backend flask_servers
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>    balance roundrobin
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>    option httpchk GET /status
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>    cookie SERVER insert indirect nocache
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>    server web-a web-a:5001 check cookie web-a fall 1 rise 5
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>    server web-b web-b:5002 check cookie web-b fall 1 rise 5
</span></code></pre></div>
</div>
<div class="tabbed-block">
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>global
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>    log stdout format raw local0
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    maxconn 4096
</span></code></pre></div>
<code>log stdout format raw</code></p>
<ul>
<li><strong>What it does</strong>:<ul>
<li>Logs activity to <code>stdout</code> in raw format, useful for debugging in development.</li>
</ul>
</li>
<li><strong>Production Improvement</strong>: Redirect logs to a centralized logging solution (e.g., ELK Stack, Splunk) for improved observability and long-term storage.</li>
</ul>
<p><code>maxconn 4096</code></p>
<ul>
<li><strong>What it does</strong>:<ul>
<li>Limits the number of simultaneous connections to 4096.</li>
</ul>
</li>
<li><strong>Production Improvement</strong>: Tune this value based on your hardware capabilities and expected traffic; perform benchmarking to find the optimal limit.</li>
</ul>
</div>
<div class="tabbed-block">
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>defaults
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    mode http
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    log     global
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    option  httplog
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    option  dontlognull
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    timeout connect 5s
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>    timeout client  10s
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>    timeout server  10s
</span></code></pre></div>
<code>mode http</code></p>
<ul>
<li><strong>What it does</strong>:<ul>
<li>Configures HAProxy to operate in HTTP mode, enabling HTTP-specific functionality.</li>
</ul>
</li>
<li><strong>Production Improvement</strong>: Ensure this mode is explicitly set for both frontend and backend sections to avoid ambiguities.</li>
</ul>
<p><code>log global</code></p>
<ul>
<li><strong>What it does</strong>:<ul>
<li>Uses the logging settings defined in the <code>global</code> section.</li>
</ul>
</li>
<li><strong>Production Improvement</strong>: Apply log levels (<code>info</code>, <code>warning</code>, etc.) to reduce noise in log output and prioritize critical information.</li>
</ul>
<p><code>option httplog</code></p>
<ul>
<li><strong>What it does</strong>:<ul>
<li>Enables detailed logging of HTTP requests.</li>
</ul>
</li>
<li><strong>Production Improvement</strong>: Retain this option and consider adding access log analysis tools for deeper insights into traffic patterns.</li>
</ul>
<p><code>option dontlognull</code></p>
<ul>
<li><strong>What it does</strong>:<ul>
<li>Prevents logging of connections with no data transfer, reducing log noise.</li>
</ul>
</li>
<li><strong>Production Improvement</strong>: Keep this option enabled to avoid cluttering logs with irrelevant entries.</li>
</ul>
<p><code>timeout connect 5s</code></p>
<ul>
<li><strong>What it does</strong>:<ul>
<li>Sets a 5-second timeout for establishing connections to backend servers.</li>
</ul>
</li>
<li><strong>Production Improvement</strong>: Adjust based on the expected latency and server performance in your environment.</li>
</ul>
<p><code>timeout client 10s</code></p>
<ul>
<li><strong>What it does</strong>:<ul>
<li>Sets a 10-second timeout for receiving data from clients.</li>
</ul>
</li>
<li><strong>Production Improvement</strong>: Fine-tune this value to match the behavior of your client applications.</li>
</ul>
<p><code>timeout server 10s</code></p>
<ul>
<li><strong>What it does</strong>:<ul>
<li>Sets a 10-second timeout for responses from backend servers.</li>
</ul>
</li>
<li><strong>Production Improvement</strong>: Increase this for resource-intensive operations or slow backend servers.</li>
</ul>
</div>
<div class="tabbed-block">
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>frontend http_front
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    bind *:60000-60001
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    default_backend backend_servers
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>    option forwardfor
</span></code></pre></div>
<code>bind *:60000-60001</code></p>
<ul>
<li><strong>What it does</strong>:<ul>
<li>Listens on ports 60000-60001 for incoming HTTP traffic.</li>
</ul>
</li>
<li><strong>Production Improvement</strong>: Use port 443 and SSL certificates for secure HTTPS communication (e.g., <code>bind *:443 ssl crt /path/to/cert.pem</code>).</li>
</ul>
<p><code>default_backend backend_servers</code></p>
<ul>
<li><strong>What it does</strong>:<ul>
<li>Routes all incoming traffic to the <code>backend_servers</code> section.</li>
</ul>
</li>
<li><strong>Production Improvement</strong>: Configure separate frontends and backends for different types of traffic, such as APIs or admin interfaces.</li>
</ul>
<p><code>option forwardfor</code></p>
<ul>
<li><strong>What it does</strong>:<ul>
<li>Adds the <code>X-Forwarded-For</code> header to requests, preserving the client IP address.</li>
</ul>
</li>
<li><strong>Production Improvement</strong>: Retain this option for proper logging and troubleshooting, especially when using HAProxy as a reverse proxy.</li>
</ul>
</div>
<div class="tabbed-block">
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>backend flask_servers
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>    balance roundrobin
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>    option httpchk GET /status
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>    cookie SERVER insert indirect nocache
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>    server web-a web-a:5001 check cookie web-a fall 1 rise 5
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>    server web-b web-b:5002 check cookie web-b fall 1 rise 5
</span></code></pre></div>
<code>balance roundrobin</code></p>
<ul>
<li><strong>What it does</strong>:<ul>
<li>Distributes traffic evenly across backend servers in a round-robin fashion.</li>
</ul>
</li>
<li><strong>Production Improvement</strong>: Use algorithms like <code>leastconn</code> (for uneven workloads) or <code>source</code> (to maintain session persistence).</li>
</ul>
<p><code>option httpchk GET /status</code></p>
<ul>
<li><strong>What it does</strong>:<ul>
<li>Sends HTTP GET requests to <code>/status</code> to check the health of backend servers.</li>
</ul>
</li>
<li><strong>Production Improvement</strong>: Customize the health check endpoint to include application-level checks (e.g., database connectivity).</li>
</ul>
<p><code>cookie SERVER insert indirect nocache</code></p>
<ul>
<li><strong>What it does</strong>:<ul>
<li>Inserts a session cookie to maintain persistence across requests.</li>
</ul>
</li>
<li><strong>Production Improvement</strong>: Ensure secure cookie attributes (<code>Secure</code>, <code>HttpOnly</code>) are set when using HTTPS.</li>
</ul>
<p><code>server web-a web-a:5001 check cookie web-a fall 1 rise 5</code></p>
<ul>
<li><strong>What it does</strong>:<ul>
<li>Defines a backend server (<code>web-a</code>) at <code>web-a:5001</code> with health checks. The server is marked down after 1 failed check (<code>fall</code>) and marked up after 5 successful checks (<code>rise</code>).</li>
</ul>
</li>
<li><strong>Production Improvement</strong>: Use FQDNs for server names and tune <code>fall</code> and <code>rise</code> values to reflect real-world conditions and minimize downtime.</li>
</ul>
<p><code>server web-b web-b:5002 check cookie web-b fall 1 rise 5</code></p>
<ul>
<li><strong>What it does</strong>:<ul>
<li>Similar to <code>web-a</code>, defines another backend server (<code>web-b</code>) at <code>web-b:5002</code> with identical settings.</li>
</ul>
</li>
<li><strong>Production Improvement</strong>: Add more backend servers or dynamically scale using a service discovery mechanism like Consul or Kubernetes.</li>
</ul>
</div>
</div>
</div>
<hr />
<h3 id="recommendations-for-production">Recommendations for Production</h3>
<details class="tip">
<summary>Key Improvements for Production</summary>
<ul>
<li><strong>Centralized Logging</strong>: Send logs to external monitoring tools like ELK Stack or Splunk for detailed analysis.</li>
<li><strong>SSL Termination</strong>: Configure SSL certificates to enable secure HTTPS communication.</li>
<li><strong>Dynamic Scaling</strong>: Integrate with service discovery tools to dynamically update backend servers.</li>
<li><strong>Rate Limiting</strong>: Add protection against abuse by limiting the number of requests per IP address.</li>
<li><strong>Error Handling</strong>: Use <code>errorfile</code> directives to customize error responses.</li>
</ul>
</details>
<hr />
<h2 id="challenges-faced">Challenges Faced</h2>
<details class="danger">
<summary>Challenges Encountered</summary>
<ul>
<li>Configuration Complexity: Understanding the nuances of haproxy.cfg and adapting it for the project’s needs.</li>
<li>Logging and Monitoring: Ensuring adequate visibility into traffic distribution and server health.</li>
<li>Performance Tuning: Optimizing HAProxy settings to handle potential traffic spikes.</li>
</ul>
</details>
<h3 id="how-i-solved-them">How I Solved Them</h3>
<ul>
<li>Configuration Complexity:<ul>
<li>Consulted official HAProxy documentation and online resources.</li>
<li>Experimented with different configurations to find the most suitable setup.</li>
</ul>
</li>
<li>Logging and Monitoring:<ul>
<li>Integrated logging using the log directive in haproxy.cfg.</li>
<li>Enabled health checks for backend servers.</li>
</ul>
</li>
<li>Performance Tuning:<ul>
<li>Adjusted maxconn and timeout settings to accommodate varying traffic loads.</li>
</ul>
</li>
</ul>
<h2 id="lessons-learned">Lessons Learned</h2>
<details class="quote">
<summary>Key Takeaways</summary>
<ul>
<li>HAProxy’s flexibility allows fine-grained control over traffic distribution and server health monitoring.</li>
<li>Proper logging and monitoring are essential for diagnosing issues and ensuring high availability.</li>
<li>Iterative testing and tuning are critical for achieving optimal performance in production.</li>
</ul>
</details>
<h2 id="articles-and-resources">Articles and Resources</h2>
<p>Here are some resources I used to understand and configure HAProxy:</p>
<ul>
<li><a href="https://www.haproxy.com/documentation/" target="_blank">Official HAProxy Documentation</a></li>
<li><a href="https://www.haproxy.com/blog/the-four-essential-sections-of-an-haproxy-configuration" target="_blank">Four Essential HAProxy Configurations</a><ul>
<li>Going over: global, defaults, frontend, backend.</li>
</ul>
</li>
<li><a href="https://loadforge.com/guides/optimizing-haproxy-configuration-for-high-performance" target="_blank">Optimizing HAProxy Configuration</a><ul>
<li>Goes over more configuration settings targetted towards High Traffic.</li>
</ul>
</li>
<li><a href="https://www.haproxy.com/documentation/haproxy-configuration-tutorials/service-reliability/health-checks/" target="_blank">HAProxy Health Checks</a></li>
<li><a href="https://stackoverflow.com/questions/23512029/haproxy-health-check" target="_blank">Community Forum Discussion</a></li>
</ul>
<div class="admonition question">
<p class="admonition-title">Future Enhancements</p>
<p>Framework and Application Changes</p>
<ul>
<li>Explore more advanced load-balancing algorithms in HAProxy.</li>
<li>Evaluate the need for SSL termination at the load balancer level.</li>
</ul>
<p>Monitoring and Security</p>
<ul>
<li>Enhance monitoring with tools like <strong>Prometheus</strong> and <strong>Grafana</strong> for better traffic insights.</li>
<li>Implement additional security measures, such as rate limiting and IP whitelisting.</li>
</ul>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy", "content.code.select", "content.code.annotate"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    
  </body>
</html>